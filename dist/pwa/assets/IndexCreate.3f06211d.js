import{r as x,o as K,w as N,c as G,x as v,y as g,j as t,C as o,a7 as C,a8 as b,a5 as a,aa as e,aw as H,a4 as V,ab as y,aF as w,av as c,ax as j,a9 as tt,at as d,F,a6 as U,B as X,bC as at,a_ as et,bs as st,aG as ot}from"./index.c5c224d7.js";import{Q as lt}from"./QSelect.c9c2d97b.js";import{Q as nt}from"./QResponsive.fed81289.js";import{u as dt}from"./use-quasar.b8bd78f1.js";import{currentbranch as O,url as W}from"./axios.77a133fc.js";import{rupiah as h}from"./rupiah.ed064363.js";import{u as it}from"./category-store.09827dc8.js";import{a as rt,Q as R}from"./QSpace.a03e9777.js";import{Q as $,a as p}from"./QItem.af557ec6.js";import{Q as ct}from"./QSpinnerGears.6f2d9496.js";import{Q as ut}from"./QForm.a8be0ad3.js";import{C as Y}from"./ClosePopup.92e28685.js";import{l as J}from"./index.312ab613.js";import{u as mt}from"./branch-store.5f613c7b.js";import{u as pt}from"./transaction-store.e8932b79.js";import{u as Z}from"./vue-i18n.runtime.b7fd988f.js";import"./QItemLabel.ccd450ac.js";import"./QMenu.00791af1.js";import"./selection.eb4ba370.js";import"./format.959830d0.js";import"./use-ratio.5f2389ab.js";const _t={class:"text-h6"},ht={class:"row justify-center"},vt={class:"col-lg-8 col-md-7 col-xs-12 q-pa-md"},yt={class:"text-body1 text-bold"},bt={class:"row justify-center"},ft={class:"col-md-7 col-xs-12 q-pa-sm"},gt={class:"text-bold"},xt={class:"text-red"},qt={class:"col-md-3 col-xs-12 q-pa-sm"},$t={class:"text-bold"},wt={class:"text-grey"},Ct={class:"col-md-10 col-xs-12 q-pa-sm"},kt={class:"text-bold"},Qt={class:"text-grey"},Vt={class:"text-body1 text-bold"},At={class:"row q-my-sm"},Tt={class:"col-5 text-body1 text-bold"},Bt={class:"col-5"},It={class:"row q-my-sm"},St={class:"col-5 text-body1 text-bold"},Pt={class:"col-5"},Dt={class:"row q-my-md"},jt={class:"col-5 flex items-center text-h6 text-bold"},Ft={class:"col-5"},Ut={class:"bg-blue-2 rounded-borders"},zt={class:"text-blue-8 text-h5 text-bold text-center q-pa-sm"},Et={class:"row q-my-md"},Lt={class:"col-5 flex items-center text-h6 text-bold"},Mt={class:"col-5"},Nt={class:"bg-green-2 rounded-borders"},Rt={class:"text-green-8 text-h5 text-bold text-center q-pa-sm"},Gt={class:"col-lg-3 col-md-4 col-xs-12 q-pa-md"},Ot={class:"text-body1 text-bold"},Ht={class:"text-h6 text-center text-bold"},Wt={class:"text-body2 text-center"},Yt={class:"row"},Jt={class:"col text-grey text-left"},Kt={class:"col text-grey text-right"},Xt={class:"text-center text-caption text-grey"},Zt={__name:"DetailCreate",props:["item"],emits:["created"],setup(T,{emit:k}){const{t:u}=Z(),z=k,s=x({branch_id:O,name:T.item.name,payment_type:T.item.payment_type,total_price:T.item.total_price,discount:0,payment_amount:0,money_amount:0,change_amount:0,notes:"",transactiondetails:T.item.transactiondetails}),q=x({}),S=async()=>{try{const n=await mt().show(O);q.value=n.data.data}catch(n){console.error("Error fetching data:",n)}};K(()=>{S()});const P=()=>{const n=s.value.discount/100*s.value.total_price;s.value.payment_amount=s.value.total_price-n},B=()=>{s.value.change_amount=s.value.money_amount-s.value.payment_amount};N(()=>s.value.discount,P),N(()=>s.value.payment_amount,B),N(()=>s.value.money_amount,()=>{P(),B()});const Q=x(!1),E=G(()=>Q.value||!s.value.money_amount),A=async()=>{Q.value=!0;try{await pt().create(s.value),J.success(u("dashboard.main.transaction.successCreateMsg")),z("created"),M()}catch(n){console.error("Error submitting form:",n),J.error(n.response.data.message||u("dashboard.main.transaction.failedCreateMsg"))}Q.value=!1},I=x({money_amount:G({get(){return h(s.value.money_amount)},set(n){const i=n.replace(/[^\d]/g,"");s.value.money_amount=parseInt(i,10)||0}})}),L=n=>{I.value[n]=h(s.value[n])},M=()=>{const n=document.getElementById("print-section").innerHTML,i=window.open("","","width=80mm,height=auto");i.document.write(`
  <html>
    <head>
      <title>Print Receipt</title>
      <link href="https://cdn.jsdelivr.net/npm/quasar@latest/dist/quasar.min.css" rel="stylesheet">
      <style>
        @page { size: 80mm auto; margin: 0; }
        body { margin: 0; font-family: Arial, sans-serif; }
        .receipt-print { width: 80mm; padding: 10px; }
      </style>
    </head>
    <body>
      ${n}
    </body>
  </html>
`),i.document.close(),i.onload=()=>{i.print()}};return(n,i)=>(v(),g("div",null,[t(ut,{onSubmit:A},{default:o(()=>[t(C,{style:{"min-width":"400px"}},{default:o(()=>[t(b,{class:"row items-center q-py-sm"},{default:o(()=>[a("div",_t,e(n.$t("dashboard.main.transaction.detailText")),1),t(rt),H(t(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),t(y),t(b,{class:"scroll",style:{height:"77vh"}},{default:o(()=>[a("div",ht,[a("div",vt,[t(C,{class:"q-mb-md"},{default:o(()=>[t(b,{class:w(n.$q.dark.isActive?"bg-blue-grey-10":"bg-blue-grey-1")},{default:o(()=>[a("div",yt,e(n.$t("dashboard.main.transaction.detailCard")),1)]),_:1},8,["class"]),t(y),t(b,{class:"q-pa-md"},{default:o(()=>[a("div",bt,[a("div",ft,[a("div",gt,[c(e(n.$t("dashboard.main.transaction.data.moneyAmount"))+" ",1),a("span",xt,e(n.$t("public.requiredText")),1)]),t(j,{modelValue:I.value.money_amount,"onUpdate:modelValue":i[0]||(i[0]=_=>I.value.money_amount=_),onInput:i[1]||(i[1]=_=>L("money_amount")),outlined:"",dense:"",required:"",autofocus:""},null,8,["modelValue"])]),a("div",qt,[a("div",$t,[c(e(n.$t("dashboard.main.transaction.data.discount"))+" ",1),a("span",wt,e(n.$t("public.optionalText")),1)]),t(j,{modelValue:s.value.discount,"onUpdate:modelValue":i[2]||(i[2]=_=>s.value.discount=_),type:"number",outlined:"",dense:""},{append:o(()=>[t(tt,{name:"percent"})]),_:1},8,["modelValue"])]),a("div",Ct,[a("div",kt,[c(e(n.$t("dashboard.main.transaction.data.notes"))+" ",1),a("span",Qt,e(n.$t("public.optionalText")),1)]),t(j,{modelValue:s.value.notes,"onUpdate:modelValue":i[3]||(i[3]=_=>s.value.notes=_),type:"textarea",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1})]),_:1}),t(C,{class:"q-mt-md"},{default:o(()=>[t(b,{class:w(n.$q.dark.isActive?"bg-blue-grey-10":"bg-blue-grey-1")},{default:o(()=>[a("div",Vt,e(n.$t("dashboard.main.transaction.paymentDetailsCard")),1)]),_:1},8,["class"]),t(y),t(b,{class:"q-pa-md"},{default:o(()=>[a("div",At,[a("div",Tt,e(n.$t("dashboard.main.transaction.data.totalPrice")),1),i[4]||(i[4]=a("div",{class:"col-2"},":",-1)),a("div",Bt,e(d(h)(s.value.total_price)),1)]),a("div",It,[a("div",St,e(n.$t("dashboard.main.transaction.data.discount")),1),i[5]||(i[5]=a("div",{class:"col-2"},":",-1)),a("div",Pt,e(s.value.discount+"%"),1)]),a("div",Dt,[a("div",jt,e(n.$t("dashboard.main.transaction.data.paymentAmount")),1),i[6]||(i[6]=a("div",{class:"col-2 flex items-center"},":",-1)),a("div",Ft,[a("div",Ut,[a("div",zt,e(d(h)(s.value.payment_amount)),1)])])]),a("div",Et,[a("div",Lt,e(n.$t("dashboard.main.transaction.data.changeAmount")),1),i[7]||(i[7]=a("div",{class:"col-2 flex items-center"},":",-1)),a("div",Mt,[a("div",Nt,[a("div",Rt,e(d(h)(s.value.change_amount)),1)])])])]),_:1})]),_:1})]),a("div",Gt,[t(C,{class:"q-pb-xl",style:{height:"100%"}},{default:o(()=>[t(b,{class:w(n.$q.dark.isActive?"bg-blue-grey-10":"bg-blue-grey-1")},{default:o(()=>[a("div",Ot,e(n.$t("dashboard.main.transaction.noteCard")),1)]),_:1},8,["class"]),t(y),t(b,{id:"print-section",class:"q-pa-md"},{default:o(()=>[a("div",Ht,e(q.value.name),1),a("div",Wt,e(q.value.address),1),t(y,{class:"q-my-md"}),t(R,{dense:""},{default:o(()=>[t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.name")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(s.value.name),1)]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.paymentType")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(s.value.payment_type),1)]),_:1})]),_:1})]),_:1}),t(y,{class:"q-my-md"}),t(R,{dense:""},{default:o(()=>[(v(!0),g(F,null,U(s.value.transactiondetails,_=>(v(),X($,{key:_.id,class:"column"},{default:o(()=>[t(p,{class:"text-bold"},{default:o(()=>[c(e(_.name),1)]),_:2},1024),a("div",Yt,[a("div",Jt,e(d(h)(_.product_price))+" x"+e(_.quantity),1),a("div",Kt,e(d(h)(_.total_price)),1)])]),_:2},1024))),128))]),_:1}),t(y,{class:"q-my-md"}),t(R,{dense:""},{default:o(()=>[t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.totalPrice")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(d(h)(s.value.total_price)),1)]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.discount")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(s.value.discount)+"%",1)]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.paymentAmount")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(d(h)(s.value.payment_amount)),1)]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.moneyAmount")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(d(h)(s.value.money_amount)),1)]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,null,{default:o(()=>[c(e(d(u)("dashboard.main.transaction.data.changeAmount")),1)]),_:1}),t(p,{side:""},{default:o(()=>[c(e(d(h)(s.value.change_amount)),1)]),_:1})]),_:1})]),_:1}),t(y,{class:"q-my-md"}),a("div",Xt,e(d(u)("dashboard.main.transaction.thankYouMsg")),1)]),_:1})]),_:1})])])]),_:1}),t(y),t(at,{align:"right",class:"text-primary"},{default:o(()=>[H(t(V,{color:"primary",label:d(u)("public.cancelText"),flat:""},null,8,["label"]),[[Y]]),t(V,{type:"submit",color:"primary",label:d(u)("dashboard.main.transaction.printNotaBtn"),loading:Q.value,disable:E.value,"no-caps":""},{loading:o(()=>[t(ct)]),_:1},8,["label","loading","disable"])]),_:1})]),_:1})]),_:1})]))}},ta={class:"row justify-center q-ma-lg"},aa={class:"col-md-8 col-xs-12 q-pa-sm"},ea={class:"row justify-center"},sa={class:"col-md-6 col-xs-12 q-pa-sm"},oa={class:"text-bold"},la={class:"text-red"},na={class:"col-md-6 col-xs-12 q-pa-sm"},da={class:"text-bold"},ia={class:"text-red"},ra={class:"col-12 q-pa-sm"},ca={class:"text-h6 text-bold"},ua={class:"row"},ma=["onClick"],pa=["src"],_a={class:"text-subtitle2 text-bold q-my-xs q-pb-md",style:{"line-height":"15px"}},ha={class:"text-caption absolute absolute-bottom-left q-px-sm q-py-xs"},va={key:0},ya={class:"text-h6 text-grey text-bold"},ba={class:"col-md-4 col-xs-12 q-pa-sm"},fa=["src"],ga={class:"text-body2"},xa={class:"text-caption"},qa={class:"absolute absolute-bottom-right q-pa-sm"},$a={class:"text-body1 q-mx-sm"},wa={class:"q-py-sm"},Oa={__name:"IndexCreate",setup(T){const k=dt(),{t:u}=Z(),z=et(),s=x({name:"",payment_type:"",total_price:0,transactiondetails:[]}),q=x(!1),S=x([]),P=async()=>{try{const l=await it().branch(O);S.value=l.data.data}catch(l){console.error("Error fetching data:",l),l.response.data.status==="failed"&&z.push("/notfound")}};K(()=>{P()});const B=x([{label:u("dashboard.main.transaction.data.cash"),value:"cash"},{label:u("dashboard.main.transaction.data.qris"),value:"qris"},{label:u("dashboard.main.transaction.data.others"),value:"others"}]),Q=x(B),E=(l,m,r)=>{m(()=>{const f=l.toLowerCase();Q.value=B.value.filter(D=>D.value.toLowerCase().indexOf(f)>-1)})},A=()=>{s.value.total_price=s.value.transactiondetails.reduce((l,m)=>l+m.total_price,0)},I=l=>{const m=s.value.transactiondetails.find(r=>r.product_id===l.id);m?(m.quantity++,m.total_price=m.quantity*l.purchase_price):s.value.transactiondetails.push({product_id:l.id,name:l.name,image:l.image,purchase_price:l.purchase_price,total_price:l.purchase_price,quantity:1}),A()},L=l=>{l.quantity++,l.total_price=l.quantity*l.purchase_price,A()},M=l=>{l.quantity>1?(l.quantity--,l.total_price=l.quantity*l.purchase_price):s.value.transactiondetails=s.value.transactiondetails.filter(m=>m.product_id!==l.product_id),A()},n=()=>{s.value.transactiondetails=[],A()},i=G(()=>!s.value.name||!s.value.payment_type||s.value.transactiondetails==0),_=()=>{q.value=!1,s.value={name:"",payment_type:"",total_price:0,notes:"",transactiondetails:[]}};return(l,m)=>(v(),g("div",ta,[a("div",aa,[t(C,{class:w([d(k).dark.isActive?"text-grey-4":"text-grey-9","dashboard-card q-pa-md"])},{default:o(()=>[a("div",ea,[a("div",sa,[a("div",oa,[c(e(l.$t("dashboard.main.transaction.data.name"))+" ",1),a("span",la,e(l.$t("public.requiredText")),1)]),t(j,{modelValue:s.value.name,"onUpdate:modelValue":m[0]||(m[0]=r=>s.value.name=r),placeholder:l.$t("dashboard.main.transaction.data.namePlaceholder"),outlined:"",dense:"",required:"",autofocus:""},null,8,["modelValue","placeholder"])]),a("div",na,[a("div",da,[c(e(l.$t("dashboard.main.transaction.data.paymentType"))+" ",1),a("span",ia,e(l.$t("public.requiredText")),1)]),t(lt,{modelValue:s.value.payment_type,"onUpdate:modelValue":m[1]||(m[1]=r=>s.value.payment_type=r),options:Q.value,placeholder:l.$t("dashboard.main.transaction.data.paymentTypePlaceholder"),onFilter:E,"input-debounce":"0","use-input":"","fill-input":"","emit-value":"","hide-selected":"",outlined:"",dense:"",required:""},null,8,["modelValue","options","placeholder"])]),a("div",ra,[t(V,{color:"primary",label:d(u)("dashboard.main.transaction.checkoutBtn"),disable:i.value,class:"full-width q-my-md",onClick:m[3]||(m[3]=r=>q.value=!0),"no-caps":""},{default:o(()=>[t(st,{modelValue:q.value,"onUpdate:modelValue":m[2]||(m[2]=r=>q.value=r),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"","full-height":"",persistent:""},{default:o(()=>[t(Zt,{onCreated:_,item:s.value},null,8,["item"])]),_:1},8,["modelValue"])]),_:1},8,["label","disable"])])]),(v(!0),g(F,null,U(S.value,r=>(v(),g("div",{key:r.id,class:"q-my-sm"},[a("div",ca,e(r.name),1),a("div",ua,[(v(!0),g(F,null,U(r.products,f=>(v(),g("div",{key:f.id,class:"dashboard-card q-pa-sm col-xs-6 col-sm-3 col-md-3 col-lg-3 grid-style-transition",onClick:D=>I(f)},[t(C,{class:w([d(k).dark.isActive?"bg-grey-9":"bg-grey-2","dashboard-transaction-card q-pa-sm"]),flat:"",bordered:""},{default:o(()=>[t(nt,{ratio:1/1,style:{width:"100%"}},{default:o(()=>[a("img",{src:d(W)+"/products/"+f.image,class:"dashboard-transaction-image"},null,8,pa)]),_:2},1024),a("div",_a,e(f.name),1),a("div",ha,e(d(h)(f.purchase_price)),1)]),_:2},1032,["class"])],8,ma))),128)),r.products.length==0?(v(),g("div",va,[a("div",ya,e(l.$t("dashboard.main.transaction.noProductText")),1)])):ot("",!0)])]))),128))]),_:1},8,["class"])]),a("div",ba,[t(C,{class:w([d(k).dark.isActive?"text-grey-4":"text-grey-9","dashboard-card q-pa-md"])},{default:o(()=>[t(V,{color:"red",label:d(u)("dashboard.main.transaction.resetBtn"),disable:s.value.transactiondetails==0,class:"full-width q-my-sm","no-caps":"",onClick:n},null,8,["label","disable"]),(v(!0),g(F,null,U(s.value.transactiondetails,(r,f)=>(v(),X(C,{key:f,class:w([d(k).dark.isActive?"bg-grey-9":"bg-grey-2","q-my-xs"]),style:{"border-radius":"8px"},flat:""},{default:o(()=>[t(b,{class:"q-pa-sm",horizontal:""},{default:o(()=>[a("img",{src:d(W)+"/products/"+r.image,class:"col-3",style:{width:"60px",height:"60px","border-radius":"5px"}},null,8,fa),t(b,{class:"q-px-sm q-py-xs",style:{"line-height":"15px"}},{default:o(()=>[a("div",ga,e(r.name),1),a("div",xa,e(d(h)(r.total_price)),1)]),_:2},1024),a("div",qa,[t(V,{color:"primary",size:"10px",icon:"remove",onClick:D=>M(r),square:"",dense:""},null,8,["onClick"]),a("span",$a,e(r.quantity),1),t(V,{color:"primary",size:"10px",icon:"add",onClick:D=>L(r),square:"",dense:""},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["class"]))),128)),a("div",{class:w(["text-h6 text-bold text-center q-my-md",d(k).dark.isActive?"bg-grey-9":"bg-grey-2"])},[t(y),a("div",wa,e(d(u)("dashboard.main.transaction.totalPrice"))+": "+e(d(h)(s.value.total_price)),1)],2)]),_:1},8,["class"])])]))}};export{Oa as default};
